# 560. Subarray Sum Equals K - æ·±åº¦è§£æ

## ğŸ“‹ é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªæ•´æ•° `k`ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å›è¯¥æ•°ç»„ä¸­å’Œä¸º `k` çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚

å­æ•°ç»„æ˜¯æ•°ç»„ä¸­å…ƒç´ çš„è¿ç»­éç©ºåºåˆ—ã€‚

### ç¤ºä¾‹

**ç¤ºä¾‹ 1ï¼š**
```
è¾“å…¥ï¼šnums = [1,1,1], k = 2
è¾“å‡ºï¼š2
```

**ç¤ºä¾‹ 2ï¼š**
```
è¾“å…¥ï¼šnums = [1,2,3], k = 3
è¾“å‡ºï¼š2
```

---

## ğŸ” ç®—æ³•åˆ†æ

### 1. æš´åŠ›è§£æ³•ï¼ˆO(nÂ²)ï¼‰

#### æ€è·¯
1. æ„å»ºä¸€ä¸ªå‰ç¼€å’Œæ•°ç»„ï¼Œæ¯ä¸ªä½ç½®çš„å…ƒç´ éƒ½æ˜¯ä»åŸæ•°ç»„çš„ 0 ä½ç½®å¼€å§‹ç´¯åŠ å¾—åˆ°å€¼
2. éå†å‰ç¼€å’Œæ•°ç»„
   - å¦‚æœå½“å‰ä½ç½®çš„å€¼ç­‰äº kï¼Œåˆ™è®¡æ•°åŠ  1
   - ç„¶åå¼€å§‹ä» i + 1 çš„ä½ç½®ç»§ç»­éå†ï¼Œä½¿ç”¨å½“å‰ä½ç½®çš„å€¼å‡å» i ä½ç½®çš„å€¼ï¼Œæ˜¯å¦ç­‰äº kï¼Œå¦‚æœç­‰äº kï¼Œåˆ™è®¡æ•°åŠ  1
3. è¿”å›è®¡æ•°

#### éªŒè¯
ä»¥ `nums = [1, 1, 1], k = 2` ä¸ºä¾‹ï¼š

- å‰ç¼€å’Œæ•°ç»„: `prefix = [1, 2, 3]`
- éå†è¿‡ç¨‹:
  - `i=0`: `prefix[0]=1 â‰  k`ï¼Œç„¶å `prefix[2]-prefix[0]=2 == k` âœ“ (å¯¹åº”å­æ•°ç»„ `[1,1]` ä» index 1-2)
  - `i=1`: `prefix[1]=2 == k` âœ“ (å¯¹åº”å­æ•°ç»„ `[1,1]` ä» index 0-1)
  - `i=2`: `prefix[2]=3 â‰  k`
- ç»“æœ `count = 2` âœ“

**ç»“è®º**ï¼šé€»è¾‘æ­£ç¡®ï¼Œä½†æ—¶é—´å¤æ‚åº¦ O(nÂ²)ï¼Œå¯¹äºå¤§è§„æ¨¡æ•°æ®å¯èƒ½è¶…æ—¶ã€‚

---

### 2. å“ˆå¸Œè¡¨ + å‰ç¼€å’Œï¼ˆO(n) æœ€ä¼˜è§£ï¼‰

#### æ ¸å¿ƒæ€æƒ³

å°† **O(nÂ²) çš„åŒé‡å¾ªç¯**ï¼š
```python
for i in range(n):
    for j in range(i, n):
        if prefix[j] - prefix[i-1] == k:  # æšä¸¾æ‰€æœ‰ (i, j) å¯¹
            count += 1
```

è½¬åŒ–æˆ **O(n) çš„å•æ¬¡éå† + å“ˆå¸ŒæŸ¥æ‰¾**ï¼š
```python
for j in range(n):
    # ä¸ç”¨æšä¸¾ iï¼Œç›´æ¥æŸ¥ map é‡Œæœ‰å¤šå°‘ä¸ª prefix[i] == prefix[j] - k
    count += map.get(prefix[j] - k, 0)
```

#### å…³é”®ç‚¹

1. **`prefix_sum - k` åœ¨ map ä¸­**
   - å¦‚æœ `prefix[j] - prefix[i] = k`ï¼Œåˆ™ `prefix[i] = prefix[j] - k`
   - æˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾ `prefix_sum - k` æ˜¯å¦ä¹‹å‰å‡ºç°è¿‡

2. **map çš„ key æ˜¯ `prefix_sum`**
   - `map[prefix_sum]` è®°å½•è¯¥å‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°
   - `prefix_sum - k` çš„å€¼åœ¨ map ä¸­å‡ºç°å‡ æ¬¡ï¼Œå°±å­˜åœ¨å‡ ä¸ªå­æ•°ç»„å’Œä¸º k

#### ç®—æ³•å®ç°

```python
def subarraySum(self, nums: List[int], k: int) -> int:
    count = 0
    prefix_sum = 0
    # è®°å½•å‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°ï¼Œåˆå§‹åŒ– {0: 1} è¡¨ç¤ºå‰ç¼€å’Œä¸º 0 å‡ºç° 1 æ¬¡
    prefix_count = {0: 1}
    
    for num in nums:
        prefix_sum += num
        # å¦‚æœ prefix_sum - k ä¹‹å‰å‡ºç°è¿‡ï¼Œè¯´æ˜å­˜åœ¨å’Œä¸º k çš„å­æ•°ç»„
        if prefix_sum - k in prefix_count:
            count += prefix_count[prefix_sum - k]
        # æ›´æ–°å½“å‰å‰ç¼€å’Œçš„å‡ºç°æ¬¡æ•°ï¼ˆç´¯åŠ ï¼Œä¸è¦†ç›–ï¼‰
        prefix_count[prefix_sum] = prefix_count.get(prefix_sum, 0) + 1
    
    return count
```

---

## ğŸ“Š è¯¦ç»†ç¤ºä¾‹è§£æ

### ä¾‹å­ï¼š`nums = [1, 1, 1], k = 2`

| æ­¥éª¤ | num | prefix_sum | prefix_sum - k | prefix_count ä¸­æŸ¥æ‰¾ | count | æ›´æ–° prefix_count |
|------|-----|------------|----------------|---------------------|-------|-------------------|
| åˆå§‹ | - | 0 | - | - | 0 | {0: 1} |
| 1 | 1 | 1 | -1 | ä¸å­˜åœ¨ | 0 | {0: 1, 1: 1} |
| 2 | 1 | 2 | 0 | å­˜åœ¨ï¼æ¬¡æ•°=1 | **1** | {0: 1, 1: 1, 2: 1} |
| 3 | 1 | 3 | 1 | å­˜åœ¨ï¼æ¬¡æ•°=1 | **2** | {0: 1, 1: 1, 2: 1, 3: 1} |

#### ç¬¬2æ­¥ï¼ˆå¤„ç†ç¬¬äºŒä¸ª 1ï¼‰è¯¦è§£
- `prefix_sum = 2`ï¼ˆå³ `nums[0] + nums[1] = 1 + 1`ï¼‰
- æŸ¥æ‰¾ `prefix_sum - k = 2 - 2 = 0`
- `0` åœ¨ `prefix_count` ä¸­å­˜åœ¨ï¼
- **å«ä¹‰**ï¼šå­˜åœ¨ä¸€ä¸ªä½ç½®ï¼Œå®ƒä¹‹å‰çš„å‰ç¼€å’Œæ˜¯ 0ï¼ˆå³"ä»€ä¹ˆéƒ½æ²¡å–"ï¼‰
- æ‰€ä»¥ `prefix[1] - 0 = 2 = k` â†’ å­æ•°ç»„ **[1, 1]**ï¼ˆindex 0-1ï¼‰âœ“

#### ç¬¬3æ­¥ï¼ˆå¤„ç†ç¬¬ä¸‰ä¸ª 1ï¼‰è¯¦è§£
- `prefix_sum = 3`ï¼ˆå³ `nums[0] + nums[1] + nums[2] = 1 + 1 + 1`ï¼‰
- æŸ¥æ‰¾ `prefix_sum - k = 3 - 2 = 1`
- `1` åœ¨ `prefix_count` ä¸­å­˜åœ¨ï¼ï¼ˆç¬¬1æ­¥æ—¶è®°å½•çš„ï¼‰
- **å«ä¹‰**ï¼šåœ¨ index 0 æ—¶ï¼Œå‰ç¼€å’Œæ˜¯ 1
- æ‰€ä»¥ `prefix[2] - prefix[0] = 3 - 1 = 2 = k` â†’ å­æ•°ç»„ **[1, 1]**ï¼ˆindex 1-2ï¼‰âœ“

#### å›¾ç¤ºç†è§£

```
æ•°ç»„:      [  1,    1,    1  ]
ç´¢å¼•:         0     1     2
å‰ç¼€å’Œ:       1     2     3
              â†‘           â†‘
              â”‚           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              prefix[2] - prefix[0] = 3 - 1 = 2 = k
              å¯¹åº”å­æ•°ç»„: nums[1..2] = [1, 1]
```

---

## ğŸ”§ æ‰©å±•ï¼šå¦‚ä½•ç¡®å®šå­æ•°ç»„çš„å…·ä½“èŒƒå›´ï¼Ÿ

### é—®é¢˜

å¦‚æœé¢˜ç›®è¦æ±‚è¿”å›æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å­æ•°ç»„èŒƒå›´ï¼Œè€Œä¸ä»…ä»…æ˜¯æ•°é‡ï¼Œåº”è¯¥å¦‚ä½•å­˜å‚¨ï¼Ÿ

### è§£å†³æ–¹æ¡ˆ

å°† map çš„ value ä»**æ¬¡æ•°**æ”¹æˆ**ç´¢å¼•åˆ—è¡¨**ï¼š

```python
# åŸæ¥ï¼šåªè®°å½•æ¬¡æ•°
prefix_count = {prefix_sum: å‡ºç°æ¬¡æ•°}

# æ”¹è¿›ï¼šè®°å½•æ‰€æœ‰å‡ºç°è¯¥å‰ç¼€å’Œçš„ç´¢å¼•ä½ç½®
prefix_indices = {prefix_sum: [index1, index2, ...]}
```

### å®Œæ•´å®ç°

#### æ–¹å¼1ï¼šè¿”å›èŒƒå›´ç´¢å¼• `[(start, end), ...]`

```python
def subarraySumRanges(nums, k):
    results = []
    prefix_sum = 0
    # key: å‰ç¼€å’Œ, value: å‡ºç°è¯¥å‰ç¼€å’Œæ—¶çš„ç´¢å¼•åˆ—è¡¨
    # åˆå§‹åŒ– {0: [-1]} è¡¨ç¤ºåœ¨ index -1 æ—¶å‰ç¼€å’Œä¸º 0ï¼ˆå³"ä»€ä¹ˆéƒ½æ²¡å–"ï¼‰
    prefix_indices = {0: [-1]}
    
    for j, num in enumerate(nums):
        prefix_sum += num
        target = prefix_sum - k
        
        # å¦‚æœ target ä¹‹å‰å‡ºç°è¿‡ï¼Œè®°å½•æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŒƒå›´
        if target in prefix_indices:
            for i in prefix_indices[target]:
                # å­æ•°ç»„èŒƒå›´æ˜¯ [i+1, j]
                results.append((i + 1, j))
        
        # è®°å½•å½“å‰å‰ç¼€å’Œå¯¹åº”çš„ç´¢å¼•ï¼ˆè¿½åŠ ï¼Œä¸è¦†ç›–ï¼‰
        if prefix_sum not in prefix_indices:
            prefix_indices[prefix_sum] = []
        prefix_indices[prefix_sum].append(j)
    
    return results  # [(0, 1), (1, 2)]
```

#### æ–¹å¼2ï¼šè¿”å›å®é™…å­æ•°ç»„ `[[1, 1], [1, 1]]`

```python
def subarraySumArrays(nums, k):
    results = []
    prefix_sum = 0
    prefix_indices = {0: [-1]}
    
    for j, num in enumerate(nums):
        prefix_sum += num
        target = prefix_sum - k
        
        if target in prefix_indices:
            for i in prefix_indices[target]:
                results.append(nums[i + 1 : j + 1])  # åˆ‡ç‰‡è·å–å®é™…å…ƒç´ 
        
        if prefix_sum not in prefix_indices:
            prefix_indices[prefix_sum] = []
        prefix_indices[prefix_sum].append(j)
    
    return results  # [[1, 1], [1, 1]]
```

#### æ–¹å¼3ï¼šåŒæ—¶è¿”å›ä¸ªæ•°å’ŒèŒƒå›´

```python
def subarraySumFull(nums, k):
    count = 0
    ranges = []
    prefix_sum = 0
    prefix_indices = {0: [-1]}
    
    for j, num in enumerate(nums):
        prefix_sum += num
        target = prefix_sum - k
        
        if target in prefix_indices:
            for i in prefix_indices[target]:
                count += 1
                ranges.append((i + 1, j))
        
        if prefix_sum not in prefix_indices:
            prefix_indices[prefix_sum] = []
        prefix_indices[prefix_sum].append(j)
    
    return count, ranges  # (2, [(0, 1), (1, 2)])
```

### å…³é”®ç‚¹

1. **åˆå§‹åŒ– `{0: [-1]}`**ï¼šè¡¨ç¤ºåœ¨"å¼€å§‹ä¹‹å‰"ï¼ˆindex = -1ï¼‰å‰ç¼€å’Œä¸º 0ï¼Œè¿™æ ·å½“ `prefix_sum == k` æ—¶ï¼Œèƒ½æ‰¾åˆ°ä» index 0 å¼€å§‹çš„å­æ•°ç»„

2. **èŒƒå›´æ˜¯ `[i+1, j]`**ï¼šå› ä¸º `prefix[j] - prefix[i] = k` ä»£è¡¨çš„æ˜¯ä» `i+1` åˆ° `j` çš„å­æ•°ç»„å’Œ

3. **è¿½åŠ ï¼Œä¸è¦†ç›–**ï¼šç›¸åŒçš„å‰ç¼€å’Œå‡ºç°æ—¶ï¼Œæ˜¯è¿½åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯è¦†ç›–ï¼š
   ```python
   if prefix_sum not in prefix_indices:
       prefix_indices[prefix_sum] = []
   prefix_indices[prefix_sum].append(j)  # è¿½åŠ æ–°ç´¢å¼•åˆ°åˆ—è¡¨
   ```

4. **æ—¶é—´å¤æ‚åº¦**ï¼šæœ€åæƒ…å†µä¸‹é€€åŒ–åˆ° O(nÂ²)ï¼ˆå½“æ‰€æœ‰å‰ç¼€å’Œç›¸åŒæ—¶ï¼‰ï¼Œä½†ä¸€èˆ¬æƒ…å†µä»ç„¶é«˜æ•ˆ

### éªŒè¯ç¤ºä¾‹

`nums = [1, 1, 1], k = 2`

| j | num | prefix_sum | target | prefix_indices æŸ¥æ‰¾ | è®°å½•èŒƒå›´ | æ›´æ–° prefix_indices |
|---|-----|------------|--------|---------------------|----------|---------------------|
| 0 | 1 | 1 | -1 | ä¸å­˜åœ¨ | - | {0: [-1], 1: [0]} |
| 1 | 1 | 2 | 0 | å­˜åœ¨ï¼ç´¢å¼•=[-1] | **(0, 1)** | {0: [-1], 1: [0], 2: [1]} |
| 2 | 1 | 3 | 1 | å­˜åœ¨ï¼ç´¢å¼•=[0] | **(1, 2)** | {0: [-1], 1: [0], 2: [1], 3: [2]} |

**ç»“æœ**: `[(0, 1), (1, 2)]`
- `(0, 1)` â†’ `nums[0:2] = [1, 1]`
- `(1, 2)` â†’ `nums[1:3] = [1, 1]`

---

## â“ å¸¸è§é—®é¢˜

### Q1: ç›¸åŒçš„å‰ç¼€å’Œæ˜¯å¦ä¼šè¦†ç›– valueï¼Ÿ

**A:** ä¸ä¼šè¦†ç›–ï¼å› ä¸ºæˆ‘ä»¬è®¾è®¡çš„ value æ˜¯**åˆ—è¡¨**ï¼Œç›¸åŒçš„å‰ç¼€å’Œå‡ºç°æ—¶æ˜¯**è¿½åŠ **ï¼Œè€Œä¸æ˜¯è¦†ç›–ã€‚

**ç¤ºä¾‹**ï¼š`nums = [1, -1, 1, 1], k = 1`

| j | num | prefix_sum | prefix_indices å˜åŒ– |
|---|-----|------------|---------------------|
| 0 | 1 | 1 | {0: [-1], **1: [0]**} |
| 1 | -1 | 0 | {**0: [-1, 1]**, 1: [0]} â† è¿½åŠ ï¼Œä¸è¦†ç›– |
| 2 | 1 | 1 | {0: [-1, 1], **1: [0, 2]**} â† è¿½åŠ ï¼Œä¸è¦†ç›– |
| 3 | 1 | 2 | {0: [-1, 1], 1: [0, 2], 2: [3]} |

å¯ä»¥çœ‹åˆ°ï¼š
- `prefix_sum = 0` å‡ºç°äº† 2 æ¬¡ï¼ˆindex -1 å’Œ 1ï¼‰ï¼Œåˆ—è¡¨æ˜¯ `[-1, 1]`
- `prefix_sum = 1` å‡ºç°äº† 2 æ¬¡ï¼ˆindex 0 å’Œ 2ï¼‰ï¼Œåˆ—è¡¨æ˜¯ `[0, 2]`

å¯¹äºåªç»Ÿè®¡æ¬¡æ•°çš„åŸç‰ˆï¼Œä¹Ÿæ˜¯**ç´¯åŠ **ï¼Œä¸æ˜¯è¦†ç›–ï¼š
```python
prefix_count[prefix_sum] = prefix_count.get(prefix_sum, 0) + 1
```

### Q2: å¦‚æœè¦è¿”å›åˆ—è¡¨ï¼Œæ€ä¹ˆè¿”å›ï¼Ÿ

**A:** `results` æ˜¯åœ¨**éå†è¿‡ç¨‹ä¸­**é€æ­¥æ„å»ºçš„ï¼Œæ¯æ¬¡å‘ç°ç¬¦åˆæ¡ä»¶æ—¶å°±è¿½åŠ ï¼š

```python
if target in prefix_indices:
    for i in prefix_indices[target]:  # éå†æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„èµ·å§‹ä½ç½®
        results.append(...)           # è¿½åŠ åˆ°ç»“æœåˆ—è¡¨
```

æœ€åç›´æ¥ `return results` å³å¯ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰æ‰¾åˆ°çš„å­æ•°ç»„ã€‚

---

## ğŸ“š ç›¸å…³ LeetCode é¢˜ç›®

| é¢˜å· | é¢˜ç›® | è¦æ±‚ | éš¾åº¦ |
|------|------|------|------|
| **560** | Subarray Sum Equals K | è¿”å›**æ•°é‡** | Medium |
| **325** | Maximum Size Subarray Sum Equals k | è¿”å›**æœ€é•¿é•¿åº¦**ï¼ˆPremiumï¼‰ | Medium |
| **209** | Minimum Size Subarray Sum | è¿”å›**æœ€çŸ­é•¿åº¦**ï¼ˆå’Œ â‰¥ targetï¼‰ | Medium |
| **862** | Shortest Subarray with Sum at Least K | è¿”å›**æœ€çŸ­é•¿åº¦**ï¼ˆå¯å«è´Ÿæ•°ï¼‰ | Hard |
| **523** | Continuous Subarray Sum | **åˆ¤æ–­æ˜¯å¦å­˜åœ¨**ï¼ˆå’Œä¸º k çš„å€æ•°ï¼‰ | Medium |
| **974** | Subarray Sums Divisible by K | è¿”å›**æ•°é‡**ï¼ˆå’Œèƒ½è¢« k æ•´é™¤ï¼‰ | Medium |
| **930** | Binary Subarrays With Sum | è¿”å›**æ•°é‡**ï¼ˆäºŒè¿›åˆ¶æ•°ç»„ï¼‰ | Medium |
| **1** | Two Sum | è¿”å›**ä¸¤ä¸ªç´¢å¼•** | Easy |
| **167** | Two Sum II | è¿”å›**ä¸¤ä¸ªç´¢å¼•**ï¼ˆæœ‰åºæ•°ç»„ï¼‰ | Easy |

### ä¸ºä»€ä¹ˆå¾ˆå°‘è¦æ±‚è¿”å›æ‰€æœ‰èŒƒå›´ï¼Ÿ

1. **ç»“æœè§„æ¨¡**ï¼šæœ€åæƒ…å†µä¸‹æœ‰ O(nÂ²) ä¸ªå­æ•°ç»„ï¼Œä¸é€‚åˆä½œä¸ºè¾“å‡º
2. **é¢˜ç›®ä»·å€¼**ï¼šç®—æ³•çš„æ ¸å¿ƒåœ¨äº"é«˜æ•ˆè®¡æ•°"ï¼Œè€Œé"æšä¸¾æ‰€æœ‰"
3. **å®é™…åº”ç”¨**ï¼šé€šå¸¸åªå…³å¿ƒæ•°é‡ã€æœ€é•¿/æœ€çŸ­ã€æˆ–æ˜¯å¦å­˜åœ¨

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒç®—æ³•æ€æƒ³

1. **å‰ç¼€å’Œ**ï¼š`prefix[i] = nums[0] + nums[1] + ... + nums[i]`
2. **å­æ•°ç»„å’Œ**ï¼š`sum(nums[i..j]) = prefix[j] - prefix[i-1]`
3. **è½¬æ¢**ï¼š`prefix[j] - prefix[i] = k` â†’ `prefix[i] = prefix[j] - k`
4. **å“ˆå¸Œä¼˜åŒ–**ï¼šç”¨ map è®°å½•å‰ç¼€å’Œå‡ºç°æ¬¡æ•°ï¼ŒO(1) æŸ¥æ‰¾æ›¿ä»£ O(n) æšä¸¾

### æ—¶é—´å¤æ‚åº¦å¯¹æ¯”

- **æš´åŠ›è§£æ³•**ï¼šO(nÂ²) - åŒé‡å¾ªç¯æšä¸¾æ‰€æœ‰ (i, j) å¯¹
- **å“ˆå¸Œè¡¨ä¼˜åŒ–**ï¼šO(n) - å•æ¬¡éå† + O(1) å“ˆå¸ŒæŸ¥æ‰¾

### ç©ºé—´å¤æ‚åº¦

- **æš´åŠ›è§£æ³•**ï¼šO(n) - å‰ç¼€å’Œæ•°ç»„
- **å“ˆå¸Œè¡¨ä¼˜åŒ–**ï¼šO(n) - å“ˆå¸Œè¡¨ï¼ˆæœ€åæƒ…å†µæ‰€æœ‰å‰ç¼€å’Œéƒ½ä¸åŒï¼‰

### å…³é”®æŠ€å·§

- **åˆå§‹åŒ– `{0: 1}`**ï¼šå¤„ç†ä» index 0 å¼€å§‹çš„å­æ•°ç»„
- **ç´¯åŠ è®¡æ•°**ï¼šç›¸åŒå‰ç¼€å’Œå‡ºç°å¤šæ¬¡æ—¶ï¼Œç´¯åŠ æ¬¡æ•°è€Œéè¦†ç›–
- **ç©ºé—´æ¢æ—¶é—´**ï¼šç”¨å“ˆå¸Œè¡¨å­˜å‚¨å†å²ä¿¡æ¯ï¼Œé¿å…é‡å¤è®¡ç®—

---

## ğŸ“ å®Œæ•´ä»£ç å®ç°

```python
from typing import List

class Solution:
    def subarraySum(self, nums: List[int], k: int) -> int:
        """
        560. Subarray Sum Equals K
        
        æ—¶é—´å¤æ‚åº¦: O(n)
        ç©ºé—´å¤æ‚åº¦: O(n)
        """
        count = 0
        prefix_sum = 0
        # è®°å½•å‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°ï¼Œåˆå§‹åŒ– {0: 1} è¡¨ç¤ºå‰ç¼€å’Œä¸º 0 å‡ºç° 1 æ¬¡
        prefix_count = {0: 1}
        
        for num in nums:
            prefix_sum += num
            # å¦‚æœ prefix_sum - k ä¹‹å‰å‡ºç°è¿‡ï¼Œè¯´æ˜å­˜åœ¨å’Œä¸º k çš„å­æ•°ç»„
            if prefix_sum - k in prefix_count:
                count += prefix_count[prefix_sum - k]
            # æ›´æ–°å½“å‰å‰ç¼€å’Œçš„å‡ºç°æ¬¡æ•°ï¼ˆç´¯åŠ ï¼Œä¸è¦†ç›–ï¼‰
            prefix_count[prefix_sum] = prefix_count.get(prefix_sum, 0) + 1
        
        return count


# æ‰©å±•ï¼šè¿”å›æ‰€æœ‰å­æ•°ç»„èŒƒå›´
def subarraySumRanges(nums: List[int], k: int) -> List[tuple]:
    """
    è¿”å›æ‰€æœ‰å’Œä¸º k çš„å­æ•°ç»„èŒƒå›´ (start, end)
    """
    results = []
    prefix_sum = 0
    prefix_indices = {0: [-1]}
    
    for j, num in enumerate(nums):
        prefix_sum += num
        target = prefix_sum - k
        
        if target in prefix_indices:
            for i in prefix_indices[target]:
                results.append((i + 1, j))
        
        if prefix_sum not in prefix_indices:
            prefix_indices[prefix_sum] = []
        prefix_indices[prefix_sum].append(j)
    
    return results


if __name__ == "__main__":
    solution = Solution()
    
    # æµ‹è¯•ç”¨ä¾‹ 1
    print(solution.subarraySum([1, 1, 1], 2))  # è¾“å‡º: 2
    
    # æµ‹è¯•ç”¨ä¾‹ 2
    print(solution.subarraySum([1, 2, 3], 3))  # è¾“å‡º: 2
    
    # æµ‹è¯•è¿”å›èŒƒå›´
    print(subarraySumRanges([1, 1, 1], 2))  # è¾“å‡º: [(0, 1), (1, 2)]
```

---

*æœ€åæ›´æ–°ï¼š2026-01-16*
